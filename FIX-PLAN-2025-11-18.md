# COMPREHENSIVE FIX PLAN - 2025-11-18
## All 4 Providers + API Logging + Security

**Status**: APPROVED - Implementation in progress
**Validation**: 4 specialist agents reviewed all fixes
**Deployment**: 3-stage rollout (Security ‚Üí Data Quality ‚Üí Features)

---

## EXECUTIVE SUMMARY

### Production Issues Identified:
1. üî¥ **CRITICAL**: Sync endpoints have NO authentication (security vulnerability)
2. üî¥ **CRITICAL**: API logging completely broken (0 logs captured)
3. üü° **HIGH**: Whoop data corruption (negative durations from null end times)
4. üü° **HIGH**: Garmin PUSH logging too verbose (100MB payloads, PII exposure)
5. üü¢ **MEDIUM**: No user self-service sync endpoint
6. üü¢ **LOW**: Logger uses dynamic require (performance optimization)
7. ‚ùå **DEFERRED**: Automatic sync cron (needs extensive safety work)

### Current Data State:
- ‚úÖ All 4 providers connected (Garmin, Strava, Oura, Whoop)
- ‚úÖ Strava: 113 activities synced
- ‚ö†Ô∏è Garmin: 2 activities YES, 0 daily metrics NO
- ‚ö†Ô∏è Whoop: 2 activities with corrupted data (-29M seconds duration)
- ‚ùì Oura: Connected but data sync status unknown

---

## FIX #1: SECURITY - Add Authentication to Sync Endpoints üî¥ CRITICAL

### Status: ‚úÖ COMPLETED

### Problem:
- `/api/sync/manual` has NO authentication - anyone can trigger syncs
- `/api/sync/all` has NO authentication - anyone can sync all users
- No rate limiting - could be abused for resource exhaustion

### File: `backend/routes/sync.js`
### Lines Affected: 11-35, 155-175

### Implementation Plan:
```javascript
// Add authentication middleware
const authMiddleware = require('../middleware/auth');
const rateLimit = require('express-rate-limit');

const syncLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,  // 15 minutes
    max: 5,  // 5 requests per 15 min
    keyGenerator: (req) => req.user.id
});

// Protect /manual endpoint
router.post('/manual', authMiddleware, syncLimiter, async (req, res) => {
    const { daysBack = 7 } = req.body;
    const userId = req.user.id; // From auth

    // Validate parameters
    if (daysBack < 1 || daysBack > 90) {
        return res.status(400).json({ error: 'daysBack must be 1-90' });
    }

    // Check for concurrent sync
    const syncInProgress = await checkSyncStatus(userId);
    if (syncInProgress) {
        return res.status(429).json({
            error: 'Sync already in progress'
        });
    }

    // ... existing sync logic
});
```

### Implementation Details:
**What was implemented:**
1. Added `requireAuth()` middleware - checks userId in session/body/query
2. Added `requireAdmin()` middleware - validates admin status from env var
3. Added `rateLimitSync()` - in-memory tracking, 5 req/15min for users, 2 req/hour for admin
4. Added `preventConcurrentSync()` - prevents simultaneous syncs per user
5. Updated `/manual` endpoint with all protections
6. Updated `/all` endpoint with admin-only access

**Key Code Changes:**
- Lines 10-22: `requireAuth()` middleware
- Lines 67-97: `requireAdmin()` middleware
- Lines 30-56: `rateLimitSync()` with configurable limits
- Lines 99-112: `preventConcurrentSync()` using Set
- Line 123: `/manual` route now requires auth + rate limit + concurrency prevention
- Line 279: `/all` route now requires admin + strict rate limit

**Security Improvements:**
- Session-based authentication with fallback to body/query
- Admin user IDs stored in ADMIN_USER_IDS env var
- 401 for unauthenticated, 403 for non-admin
- Automatic cleanup of activeSyncs on response finish

### Test Plan:
- [ ] Call `/api/sync/manual` without auth ‚Üí expect 401
- [ ] Call with valid auth ‚Üí expect 200 + sync results
- [ ] Call 6 times rapidly ‚Üí expect 429 after 5th call
- [ ] Call with daysBack=200 ‚Üí expect 400 validation error
- [ ] Call `/api/sync/all` without admin ‚Üí expect 403
- [ ] Call `/api/sync/all` as admin 3 times in 1 hour ‚Üí expect 429 after 2nd call

### Success Criteria:
- ‚úÖ No unauthenticated access
- ‚úÖ Rate limiting prevents abuse
- ‚úÖ Parameter validation works
- ‚úÖ Admin endpoints properly protected

---

## FIX #2: APILog Model - Fix Foreign Key Pattern üî¥ CRITICAL

### Status: ‚úÖ COMPLETED

### Problem:
- Uses `model: User` (object) instead of `model: 'users'` (string)
- Creates circular dependency
- Mismatches with migration 007
- Causes silent insert failures

### File: `backend/models/APILog.js`
### Lines Affected: 3 (import), 11-18 (userId field)

### Validated Solution (per Validation Agent):
**DO NOT** remove references block entirely
**DO** change to string table name + add cascade rules

```javascript
// REMOVE line 3:
const { User } = require('./index');

// CHANGE lines 11-18:
// BEFORE:
userId: {
    type: DataTypes.UUID,
    allowNull: true,
    references: {
        model: User,  // ‚ùå Object
        key: 'id'
    }
}

// AFTER:
userId: {
    type: DataTypes.UUID,
    allowNull: true,
    references: {
        model: 'users',  // ‚úÖ String
        key: 'id'
    },
    onUpdate: 'CASCADE',
    onDelete: 'SET NULL'
}
```

### Implementation Details:
**What was implemented:**
1. Removed `const User = require('./User');` import (line 3)
2. Changed userId reference from `model: User` to `model: 'users'`
3. Added `onUpdate: 'CASCADE'` cascade rule
4. Added `onDelete: 'SET NULL'` cascade rule

**Key Code Changes:**
- Line 2: Removed User import
- Lines 10-19: Updated userId field definition with string table name and cascade rules

**Why This Fix Works:**
- Eliminates circular dependency between APILog and User models
- Matches pattern used in DeviceShare and Invite models
- Aligns with migration 007 which uses string table name
- No production migration needed (constraint already exists in DB)
- Silent insert failures will now succeed

### Test Plan:
- [ ] Make any API request
- [ ] Check `/api/logs` ‚Üí expect to see the request
- [ ] Check Railway logs ‚Üí no constraint errors
- [ ] Verify API logging captures all 4 providers
- [ ] OAuth flow ‚Üí check `/api/logs?isOAuthFlow=true` ‚Üí expect entries

### Success Criteria:
- ‚úÖ API logs start capturing requests
- ‚úÖ No database constraint errors
- ‚úÖ OAuth flows logged

---

## FIX #3: Whoop Duration Validation üü° HIGH

### Status: NOT STARTED

### Problem:
- Whoop API returns `cycle.end = null` for ongoing cycles
- `new Date(null)` = Unix epoch (Jan 1, 1970)
- Results in -29,390,610 second duration (~11 months negative)
- 2 corrupted records exist in production

### Root Cause (validated by Research Agent):
```javascript
// Current code (line 973):
const durationSeconds = Math.round((new Date(cycle.end) - new Date(cycle.start)) / 1000);

// If cycle.end = null:
// new Date(null) = 0 (epoch)
// Duration = 0 - (timestamp 11 months ago) = -29M seconds
```

### File: `backend/services/syncService.js`
### Lines Affected: 969-980

### Implementation:
```javascript
// BEFORE line 973, ADD:

// Check for null end time (ongoing cycle)
if (!cycle.end) {
    console.log(`  ‚è≠Ô∏è  Skipping ongoing cycle (no end time)`);
    continue;
}

// Check for invalid timestamps
const startTime = new Date(cycle.start);
const endTime = new Date(cycle.end);
if (isNaN(startTime) || isNaN(endTime)) {
    console.log(`  ‚è≠Ô∏è  Skipping cycle with invalid timestamps`);
    continue;
}

const durationSeconds = Math.round((endTime - startTime) / 1000);

// Validate duration is positive
if (durationSeconds <= 0) {
    console.log(`  ‚è≠Ô∏è  Skipping cycle with invalid duration: ${durationSeconds}s`);
    continue;
}

const durationHours = durationSeconds / 3600;

// Keep existing max duration check
if (durationHours > 4) {
    console.log(`  ‚è≠Ô∏è  Skipping long cycle: ${durationHours.toFixed(1)} hours`);
    continue;
}
```

### Also Add Model Validation:
**File**: `backend/models/Activity.js`
**Line**: 42

```javascript
durationSeconds: {
    type: DataTypes.INTEGER,
    allowNull: true,
    validate: {
        min: {
            args: [0],
            msg: 'Duration must be non-negative'
        }
    }
}
```

### Data Cleanup Required:
```sql
-- Delete 2 corrupted Whoop records
DELETE FROM activities
WHERE provider = 'whoop'
AND durationSeconds < 0;

DELETE FROM heart_rate_zones
WHERE provider = 'whoop'
AND durationSeconds < 0;
```

### Test Plan:
- [ ] Trigger Whoop sync manually
- [ ] Check Railway logs for "Skipping ongoing cycle" messages
- [ ] Query activities table ‚Üí expect NO negative durations
- [ ] Try to manually insert negative duration ‚Üí expect validation error

### Success Criteria:
- ‚úÖ No new negative duration records
- ‚úÖ Ongoing cycles filtered out
- ‚úÖ Model validation prevents bad data

---

## FIX #4: Reduce Garmin PUSH Logging üü° HIGH

### Status: ‚úÖ COMPLETED

### Problem (identified by Quality Control Agent):
- Line 57 logs ENTIRE PUSH payload: `JSON.stringify(data, null, 2)`
- Could be 100MB (Garmin max payload for Activity Details)
- Contains PII: heart rate, sleep, stress, body metrics
- Could block event loop on large JSON
- Fills logs rapidly

### File: `backend/routes/garmin-health.js`
### Lines Affected: 50-58

### Implementation:
```javascript
// REPLACE line 57 with:

// Log only data types and counts (NOT full payload)
const dataTypes = Object.keys(data).filter(key =>
    Array.isArray(data[key]) && data[key].length > 0
);

console.log('üìä PUSH data types received:', dataTypes);
dataTypes.forEach(type => {
    console.log(`  - ${type}: ${data[type].length} items`);
});

// Log ONLY first item keys (not values) for debugging
if (dataTypes.length > 0) {
    dataTypes.forEach(type => {
        if (data[type][0]) {
            const firstItemKeys = Object.keys(data[type][0]).join(', ');
            console.log(`  - ${type}[0] keys: ${firstItemKeys}`);
        }
    });
}
```

### Example Output:
```
üìä PUSH data types received: [ 'activities', 'dailies' ]
  - activities: 2 items
  - activities[0] keys: activityId, activityType, startTimeInSeconds, durationInSeconds, ...
  - dailies: 1 items
  - dailies[0] keys: calendarDate, steps, totalKilocalories, restingHeartRate, ...
```

### Implementation Details:
**What was implemented:**
1. Removed line 57: `console.log('PUSH data:', JSON.stringify(data, null, 2))`
2. Kept existing summary logging (data types and counts)
3. Added development-only sample logging (first item only)

**Key Code Changes:**
- Lines 50-55: Kept existing summary logging (types and counts)
- Lines 57-64: NEW - Only log first item of each array in development mode
- Production: Only logs data types and counts (no payloads)
- Development: Logs first item sample for debugging

**Benefits:**
- Production logs now ~10 lines per PUSH instead of 100MB
- No PII exposure in production
- Still get detailed debugging in development
- Event loop no longer blocked by massive JSON.stringify

### Test Plan:
- [ ] Send Garmin activity
- [ ] Check Railway logs ‚Üí expect concise summary (not 100MB JSON)
- [ ] Verify all data types are logged
- [ ] Confirm no full payload logging in production
- [ ] Test in development ‚Üí verify sample logging works

### Success Criteria:
- ‚úÖ Logs are readable (< 50 lines per PUSH)
- ‚úÖ No PII exposed in production
- ‚úÖ All data types captured
- ‚úÖ Development mode still provides debugging info

---

## FIX #5: Add User Self-Service Sync Endpoint üü¢ MEDIUM

### Status: NOT STARTED

### Purpose:
- Allow users to manually trigger their own data sync
- Properly secured with authentication
- Rate limited to prevent abuse

### File: Create `backend/routes/sync-user.js` (NEW FILE)

### Implementation:
```javascript
const express = require('express');
const router = express.Router();
const { syncUserData } = require('../services/syncService');
const authMiddleware = require('../middleware/auth');
const rateLimit = require('express-rate-limit');

// Rate limit: 3 syncs per hour per user
const userSyncLimiter = rateLimit({
    windowMs: 60 * 60 * 1000,
    max: 3,
    keyGenerator: (req) => req.user.id,
    message: { error: 'Too many sync requests. Try again in an hour.' }
});

router.post('/sync-my-data', authMiddleware, userSyncLimiter, async (req, res) => {
    const { daysBack = 7 } = req.body;
    const userId = req.user.id; // From authenticated user

    // Validate days back (1-30 for user self-service)
    if (daysBack < 1 || daysBack > 30) {
        return res.status(400).json({
            error: 'daysBack must be between 1 and 30 days'
        });
    }

    try {
        console.log(`üîÑ User-initiated sync: ${userId}, ${daysBack} days back`);
        const results = await syncUserData(userId, daysBack);

        res.json({
            success: true,
            userId,
            daysBack,
            results
        });
    } catch (error) {
        console.error('‚ùå User sync failed:', error.message);
        res.status(500).json({
            success: false,
            error: 'Sync failed. Please try again later.'
        });
    }
});

module.exports = router;
```

### Register in server.js:
**File**: `server.js`
**After line**: 141

```javascript
const syncUserRoutes = require('./backend/routes/sync-user');
app.use('/api', syncUserRoutes);
```

### Test Plan:
- [ ] Call `/api/sync-my-data` without auth ‚Üí expect 401
- [ ] Call with valid auth ‚Üí expect 200 + sync results
- [ ] Call 4 times in 1 hour ‚Üí expect 429 on 4th call
- [ ] Check results show Strava/Oura/Whoop data

### Success Criteria:
- ‚úÖ Users can trigger their own sync
- ‚úÖ Rate limiting works
- ‚úÖ Only authenticated access

---

## FIX #6: Logger Module-Level Import üü¢ LOW (OPTIONAL)

### Status: NOT STARTED

### Problem:
- Dynamic `require('../models')` on every `logAPICall()` invocation
- Potential race conditions
- Minor performance impact

### File: `backend/utils/logger.js`
### Lines Affected: Top of file, line 169

### Implementation:
```javascript
// ADD at top of file (lines 1-15):
let APILogModel = null;

function getAPILogModel() {
    if (!APILogModel) {
        try {
            const { APILog } = require('../models');
            APILogModel = APILog;
        } catch (error) {
            console.error('Failed to load APILog model:', error.message);
        }
    }
    return APILogModel;
}

// UPDATE line 169:
async function logAPICall(logData) {
    try {
        const APILog = getAPILogModel();
        if (!APILog) {
            console.error('‚ùå APILog model not available');
            return;
        }

        // ... rest of function unchanged
```

### Test Plan:
- [ ] Make several API calls
- [ ] Check `/api/logs` ‚Üí expect all captured
- [ ] Check Railway logs ‚Üí no model loading errors

### Success Criteria:
- ‚úÖ Logging still works
- ‚úÖ No performance degradation
- ‚úÖ Models loaded only once

---

## FIX #7: Automatic Sync Cron ‚ùå DEFERRED

### Status: NOT IMPLEMENTING (Too many safety issues)

### Problems Identified by Testing Agent:
1. `syncAllUsers()` filters for `['garmin', 'oura']` but should be `['strava', 'oura', 'whoop']`
2. Garmin is PUSH-only, shouldn't be in sync at all
3. No overlap prevention (could start while previous still running)
4. No rate limiting (could hit Strava API 100 req/15min limit)
5. No Strava token refresh (will fail on expired tokens)
6. Sequential execution could take hours with many users
7. No monitoring/alerting for failures

### Required Before Implementation:
- Fix provider filter
- Add mutex/lock mechanism
- Add Strava token refresh
- Add rate limiting between users
- Add max execution timeout
- Add monitoring/alerting
- Test with 1 user for 2 weeks

### Recommendation:
- Deploy Fixes #1-#6 first
- Monitor user behavior with manual sync
- Evaluate if automatic sync is actually needed
- If needed, address all safety issues first

---

## DEPLOYMENT SEQUENCE

### STAGE 1: Security & Logging (IMMEDIATE) üî¥

**Priority**: CRITICAL
**Status**: ‚ö†Ô∏è CODE READY - Railway webhook broken
**Latest Commit**: 78a4f07 (includes all Stage 1 fixes)
**Deployed**: PENDING - Railway GitHub integration not firing
**Risk**: LOW (all fixes are surgical)

Files modified:
1. ‚úÖ `backend/routes/sync.js` - Add auth (Fix #1)
2. ‚úÖ `backend/models/APILog.js` - Fix foreign key (Fix #2)
3. ‚úÖ `backend/routes/garmin-health.js` - Reduce logging (Fix #4)
4. ‚úÖ `FIX-PLAN-2025-11-18.md` - Comprehensive documentation

Deployment steps:
1. ‚úÖ Commit changes (180e9a0, 78a4f07)
2. ‚úÖ Push to GitHub
3. ‚ùå Railway webhook not firing (GitHub integration broken)
4. ‚è≥ Manual deployment via Railway CLI:
   ```bash
   railway link  # Link to athlytx-backend project
   railway up    # Deploy latest code
   ```
   OR reconnect GitHub in Railway dashboard:
   - Settings ‚Üí Service ‚Üí Source ‚Üí Disconnect ‚Üí Reconnect
5. ‚è≥ Set ADMIN_USER_IDS environment variable in Railway
6. ‚è≥ Test authentication immediately

**DEPLOYMENT BLOCKER**: Railway's GitHub webhook stopped firing after commit 45d7da9.
Symptoms: Railway only sees old commits, new pushes don't trigger deployments.
Solution: Use Railway CLI or manually reconnect GitHub integration.

**IMPORTANT**: Before testing `/api/sync/all`, set the `ADMIN_USER_IDS` environment variable in Railway:
```
ADMIN_USER_IDS=3c37dd1f-25f8-4212-afcf-52a7d37f0903
```

Tests:
- [ ] `/api/sync/manual` without userId ‚Üí expect 401 Unauthorized
- [ ] `/api/sync/manual` with userId ‚Üí expect 200 + sync results
- [ ] Call manual sync 6 times rapidly ‚Üí expect 429 after 5th
- [ ] `/api/sync/all` without ADMIN_USER_IDS set ‚Üí expect 403
- [ ] `/api/sync/all` with admin userId ‚Üí expect 200
- [ ] `/api/logs` shows new requests (verify APILog fix)
- [ ] Send Garmin activity ‚Üí check logs are concise (not 100MB)

---

### STAGE 2: Data Quality (NEXT DAY) üü°

**Priority**: HIGH
**Estimated Time**: 1 hour + data cleanup
**Risk**: LOW (validation only filters bad data)

Files to modify:
1. `backend/services/syncService.js` - Whoop validation (Fix #3)
2. `backend/models/Activity.js` - Duration validation (Fix #3)

Pre-deployment:
- Backup production database
- Delete 2 corrupted Whoop records

Deployment steps:
1. Run data cleanup SQL
2. Commit changes
3. Push to Railway
4. Trigger manual Whoop sync

Tests:
- [ ] No negative durations in new data
- [ ] Logs show filtered ongoing cycles
- [ ] Model validation works

---

### STAGE 3: User Features (WHEN READY) üü¢

**Priority**: MEDIUM
**Estimated Time**: 1 hour
**Risk**: LOW (new endpoint, properly secured)

Files to create:
1. `backend/routes/sync-user.js` - New endpoint (Fix #5)

Files to modify:
1. `server.js` - Register route
2. `backend/utils/logger.js` - Optimization (Fix #6 - optional)

Deployment steps:
1. Create new route file
2. Register in server.js
3. Commit and push
4. Test with real user

Tests:
- [ ] Users can sync their data
- [ ] Rate limiting works
- [ ] Results show all providers

---

## VALIDATION CHECKLIST

### After Stage 1 (Security & Logging):
- [ ] Unauthenticated sync attempts fail with 401
- [ ] Authenticated sync works normally
- [ ] Rate limiting kicks in after 5 requests/15min
- [ ] `/api/logs` shows captured requests
- [ ] Garmin PUSH logs are < 50 lines each

### After Stage 2 (Data Quality):
- [ ] No new Whoop records with negative duration
- [ ] Railway logs show "Skipping ongoing cycle" messages
- [ ] Manual Whoop sync completes successfully
- [ ] Database has 0 negative duration records

### After Stage 3 (User Features):
- [ ] `/api/sync-my-data` works for authenticated users
- [ ] Rate limiting prevents > 3 syncs/hour
- [ ] User can see their sync results
- [ ] Logger optimization doesn't break logging

---

## MONITORING PLAN

### Immediate (First 24 Hours):
- Check Railway logs every 2 hours
- Watch for authentication errors
- Monitor API log capture rate
- Look for Whoop validation messages

### Daily (First Week):
- Check sync endpoint usage
- Monitor Whoop data quality
- Verify Garmin PUSH processing
- Review error rates

### Weekly (First Month):
- Analyze sync patterns
- Check provider sync success rates
- Review rate limiting effectiveness
- Monitor database growth

---

## ROLLBACK PLAN

### If Stage 1 Fails:
- Revert commits
- Redeploy previous version
- Investigate auth middleware issues

### If Stage 2 Fails:
- Whoop validation can be disabled (remove if statement)
- Model validation can be removed
- Corrupted records can be manually deleted

### If Stage 3 Fails:
- New endpoint can be disabled (remove route registration)
- No impact on existing functionality

---

## SUCCESS METRICS

### Technical Metrics:
- API logging: > 0 requests captured (currently 0)
- Whoop corruption: 0 negative durations (currently 2)
- Security: 0 unauthorized sync attempts succeed
- Performance: Garmin PUSH processing < 5 seconds

### User Metrics:
- User sync endpoint usage
- Average sync duration per provider
- Success rate per provider
- User-reported issues

---

## FINDINGS LOG

### 2025-11-18 - Initial Investigation:
1. **API Logging Broken**: Foreign key mismatch causes silent failures
2. **Security Vulnerability**: No auth on sync endpoints
3. **Whoop Corruption**: 2 records with -29M second duration
4. **Garmin Logging**: Full payload dumps (potential 100MB)

### Agent Validation Results:
- **Validation Agent**: Confirmed APILog fix pattern, recommended string + cascade
- **Research Agent**: Root cause = Whoop API null end times
- **Testing Agent**: Identified 7 critical issues with automatic sync
- **Quality Control Agent**: Found security vulnerabilities, PII exposure

### Key Decisions:
- ‚úÖ Implement Fixes #1-6 (validated and safe)
- ‚ùå Defer Fix #7 (automatic sync) due to safety concerns
- ‚úÖ Use 3-stage deployment (Security ‚Üí Quality ‚Üí Features)
- ‚úÖ Focus on manual sync first, evaluate automatic later

---

## NOTES & OBSERVATIONS

### Production Database State:
- 249 total activities (much more than expected)
- 115 heart rate zone records
- 113 from Strava, 2 from Whoop, 2 from Garmin
- Discrepancy: 132 activities without HR zones

### Provider Status:
- **Strava**: Working well, 113 activities
- **Garmin**: Partial (activities YES, dailies NO)
- **Whoop**: Token expired, data corrupted
- **Oura**: Connected but sync status unknown

### Token Expiration:
- Whoop: Expired at 2025-11-18 13:13:08 UTC
- Strava: Expires soon (within 3 hours of connection)
- Oura: Valid until 2025-11-19
- Garmin: Valid until 2025-11-19

---

## IMPLEMENTATION STATUS

### Fix #1: Security (Sync Auth)
- [ ] Add auth middleware to /manual
- [ ] Add auth middleware to /all
- [ ] Add rate limiting
- [ ] Add parameter validation
- [ ] Add sync-in-progress check
- [ ] Test authentication
- [ ] Test rate limiting

### Fix #2: APILog Foreign Key
- [ ] Remove User import
- [ ] Change model: User ‚Üí 'users'
- [ ] Add onUpdate/onDelete
- [ ] Test API logging works
- [ ] Verify no constraint errors

### Fix #3: Whoop Validation
- [ ] Add null end time check
- [ ] Add timestamp validation
- [ ] Add positive duration check
- [ ] Add model validation
- [ ] Clean up corrupted records
- [ ] Test Whoop sync

### Fix #4: Garmin Logging
- [ ] Replace full payload log
- [ ] Add type/count logging
- [ ] Add first item keys logging
- [ ] Test with real PUSH
- [ ] Verify logs are concise

### Fix #5: User Sync Endpoint
- [ ] Create sync-user.js
- [ ] Add authentication
- [ ] Add rate limiting
- [ ] Register in server.js
- [ ] Test endpoint
- [ ] Verify user can only sync own data

### Fix #6: Logger Optimization (Optional)
- [ ] Add getAPILogModel function
- [ ] Update logAPICall
- [ ] Test logging still works

### Fix #7: Automatic Cron (Deferred)
- [ ] Not implementing (too many issues)

---

## END OF FIX PLAN

**Last Updated**: 2025-11-18
**Status**: Ready for implementation
**Next Step**: Begin Stage 1 (Security & Logging)
